<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapace - Chatbot IA Avancé</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #222223;
            color: #e3e3e3;
        }
        header {
            background-color: #1c1c1e;
            padding: 10px 0;
            position: fixed;
            height: 100%;
            width: 90px;
            top: 0;
            left: 0;
            z-index: 1000;
            border-radius: 0px 20px 20px 0;
            box-shadow: 0 0 15px #00fffb;
            transition: width 0.3s ease;
        }
        header:hover {
            width: 120px;
        }
        nav {
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
            padding: 20px 0;
        }
        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
            flex-grow: 1;
            justify-content: center;
        }
        nav ul button {
            background-color: transparent;
            border: none;
            cursor: pointer;
            font-size: 30px;
            border-radius: 50%;
            padding: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px #00fffb;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        

        nav ul button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px #007bff;
        }
        nav ul button svg {
            width: 30px;
            height: 30px;
        }
        .user-btn {
            margin-top: auto;
            margin-bottom: 30px;
        }
        #logo {
            width: 60px;
            height: 60px;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }
        header:hover #logo {
            width: 80px;
            height: 80px;
        }
        .typewriter {
            display: flex;
            justify-content: center;
            align-items: center;
            left: 50%;
            transform: translateX(-50%);
            top: 100px;
            position: absolute;
        }
        .typewriter p {
            font-family: monospace;
            font-size: 1.8rem;
            overflow: hidden;
            color: #ffffff;
            white-space: nowrap;
            border-right: 2px solid #ffffff;
            animation: typing 3s steps(22) forwards, blink 1s step-end infinite;
        }
        @keyframes typing {
            0% { width: 0; }
            100% { width: 100%; }
        }
        @keyframes blink {
            0%, 100% { border-color: transparent; }
            50% { border-color: #ffffff; }
        }
        .chat-interface {
            position: absolute;
            left: 120px;
            right: 20px;
            top: 20px;
            bottom: 100px;
            display: flex;
            flex-direction: column;
        }
        #chat-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            scrollbar-width: thin;
            scrollbar-color: #00fffb #1c1c1e;
        }
        #chat-container::-webkit-scrollbar {
            width: 8px;
            position: absolute;
        }
        #chat-container::-webkit-scrollbar-track {
            background: #1c1c1e;
            border-radius: 10px;
        }
        #chat-container::-webkit-scrollbar-thumb {
            background-color: #00fffb;
            border-radius: 10px;
        }
        .message {
            margin-bottom: 15px;
            padding: 12px 18px;
            border-radius: 18px;
            max-width: 80%;
            line-height: 1.5;
            word-wrap: break-word;
            position: relative;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.3s ease forwards;
            top: 150px;
        }
        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .user-message {
            background-color: #0c716f;
            margin-left: auto;
            border-bottom-right-radius: 5px;
            box-shadow: 0 0 8px rgba(0, 255, 251, 0.5);
        }
        .bot-message {
            background-color: #1c1c1e;
            margin-right: auto;
            border-bottom-left-radius: 5px;
            box-shadow: 0 0 10px #00fffb;
        }
        .message-time {
            display: block;
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 5px;
            text-align: right;
        }
        #thinking-indicator {
            display: none;
            color: #0aaee0;
            font-style: italic;
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background-color: rgba(10, 174, 224, 0.1);
        }
        .input-container {
            display: flex;
            align-items: center;
            padding: 10px;
            background-color: #1c1c1e;
            border-radius: 50px;
            margin-top: 20px;
            box-shadow: 0 0 15px rgba(0, 255, 251, 0.3);
            position: relative;
        }
        #user-input {
            flex-grow: 1;
            height: 50px;
            border: none;
            background: transparent;
            color: #e3e3e3;
            font-size: 16px;
            padding: 0 20px;
            outline: none;
        }
        .send-btn {
            background-color: #0aaee0;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 251, 0.5);
        }
        .send-btn:hover {
            background-color: #007bff;
            transform: scale(1.05);
        }
        .send-btn svg {
            width: 24px;
            height: 24px;
            fill: #e3e3e3;
        }
        .voice-btn {
            background-color: #0aaee0;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 251, 0.5);
        }
        .voice-btn:hover {
            background-color: #007bff;
            transform: scale(1.05);
        }
        .voice-btn.listening {
            animation: pulse 1.5s infinite;
            background-color: #ff3b30;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 59, 48, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(255, 59, 48, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 59, 48, 0); }
        }
        .voice-btn svg {
            width: 24px;
            height: 24px;
            fill: #e3e3e3;
        }
        .settings-panel {
            position: fixed;
            right: -300px;
            top: 0;
            width: 300px;
            height: 100%;
            background-color: #1c1c1e;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.5);
            z-index: 999;
            transition: right 0.3s ease;
            padding: 20px;
            overflow-y: auto;
        }
        .settings-panel.open {
            right: 0;
        }
        .settings-btn {
            position: fixed;
            right: 20px;
            top: 20px;
            background-color: #0aaee0;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1001;
            box-shadow: 0 0 15px rgba(0, 255, 251, 0.5);
            transition: all 0.3s ease;
        }
        .settings-btn:hover {
            background-color: #007bff;
            transform: rotate(90deg);
        }
        .settings-btn svg {
            width: 24px;
            height: 24px;
            fill: #e3e3e3;
        }
        .settings-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #00fffb;
            border-bottom: 1px solid #00fffb;
            padding-bottom: 10px;
        }
        .setting-group {
            margin-bottom: 20px;
        }
        .setting-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        .voice-select {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            background-color: #2c2c2e;
            color: #e3e3e3;
            border: 1px solid #00fffb;
        }
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .slider {
            flex-grow: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            border-radius: 5px;
            background: #2c2c2e;
            outline: none;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00fffb;
            cursor: pointer;
        }
        .slider-value {
            width: 30px;
            text-align: center;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider-toggle {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #2c2c2e;
            transition: .4s;
            border-radius: 24px;
        }
        .slider-toggle:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: #e3e3e3;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider-toggle {
            background-color: #00fffb;
        }
        input:checked + .slider-toggle:before {
            transform: translateX(26px);
        }
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            padding: 8px 15px;
            background-color: #1c1c1e;
            border-radius: 18px;
            box-shadow: 0 0 10px #00fffb;
        }
        .typing-dot {
            width: 8px;
            height: 8px;
            margin: 0 2px;
            background-color: #00fffb;
            border-radius: 50%;
            opacity: 0.4;
            animation: typing-dot 1.4s infinite ease-in-out;
        }
        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes typing-dot {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
            30% { transform: translateY(-5px); opacity: 1; }
        }
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #0c716f;
            color: white;
            padding: 15px 25px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0, 255, 251, 0.5);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1001;
        }
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="typewriter">
        <p>Welcome to Rapace AI</p>
    </div>

    <header>
        <nav>
            <img id="logo" src="assets/logo.png" alt="Logo Rapace AI">
            <ul>
                <button title="Accueil"><a href="index.html"><svg fill="#e3e3e3" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M240-200h120v-240h240v240h120v-360L480-740 240-560v360Zm-80 80v-480l320-240 320 240v480H520v-240h-80v240H160Zm320-350Z"/></svg></a></button>
                <button title="Connexion"><a href="login.html"><svg fill="#e3e3e3" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M480-120v-80h280v-560H480v-80h280q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H480Zm-80-160-55-58 102-102H120v-80h327L345-622l55-58 200 200-200 200Z"/></svg></a></button>
                <button class="user-btn" title="Profil"><svg fill="#e3e3e3" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M234-276q51-39 114-61.5T480-360q69 0 132 22.5T726-276q35-41 54.5-93T800-480q0-133-93.5-226.5T480-800q-133 0-226.5 93.5T160-480q0 59 19.5 111t54.5 93Zm246-164q-59 0-99.5-40.5T340-580q0-59 40.5-99.5T480-720q59 0 99.5 40.5T620-580q0 59-40.5 99.5T480-440Zm0 360q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q53 0 100-15.5t86-44.5q-39-29-86-44.5T480-280q-53 0-100 15.5T294-220q39 29 86 44.5T480-160Zm0-360q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm0-60Zm0 360Z"/></svg></button>
            </ul>
        </nav>
    </header>

    <button class="settings-btn" id="settings-btn" title="Paramètres">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M12 15.5A3.5 3.5 0 0 1 8.5 12 3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97 0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1 0 .33.03.65.07.97l-2.11 1.66c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"/>
        </svg>
    </button>

    <div class="settings-panel" id="settings-panel">
        <h3 class="settings-title">Paramètres du Chatbot</h3>
        
        <div class="setting-group">
            <label class="setting-label">Voix du chatbot:</label>
            <select class="voice-select" id="voice-select">
                <option value="">Chargement des voix...</option>
            </select>
        </div>
        
        <div class="setting-group">
            <label class="setting-label">Vitesse de parole:</label>
            <div class="slider-container">
                <input type="range" min="0.5" max="2" step="0.1" value="1" class="slider" id="rate-slider">
                <span class="slider-value" id="rate-value">1.0</span>
            </div>
        </div>
        
        <div class="setting-group">
            <label class="setting-label">Hauteur de voix:</label>
            <div class="slider-container">
                <input type="range" min="0.5" max="2" step="0.1" value="1" class="slider" id="pitch-slider">
                <span class="slider-value" id="pitch-value">1.0</span>
            </div>
        </div>
        
        <div class="setting-group">
            <label class="setting-label">Synthèse vocale:</label>
            <label class="toggle-switch">
                <input type="checkbox" id="tts-toggle" checked>
                <span class="slider-toggle"></span>
            </label>
        </div>
        
        <div class="setting-group">
            <label class="setting-label">Reconnaissance vocale:</label>
            <label class="toggle-switch">
                <input type="checkbox" id="stt-toggle" checked>
                <span class="slider-toggle"></span>
            </label>
        </div>
    </div>

    <div class="chat-interface">
        <div id="chat-container"></div>
        <div id="thinking-indicator">
            <div class="typing-indicator">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <span style="margin-left: 10px;">Rapace réfléchit...</span>
            </div>
        </div>
        
        <div class="input-container">
            <input type="text" id="user-input" placeholder="Tapez votre message ou cliquez sur le micro..." autocomplete="off">
            <button class="send-btn" id="send-button" title="Envoyer">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                    <path d="M120-160v-640l760 320-760 320Zm80-120 474-200-474-200v140l240 60-240 60v140Zm0 0v-400 400Z"/>
                </svg>
            </button>
            <button class="voice-btn" id="voice-button" title="Parler">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M12 2a3 3 0 0 0-3 3v6a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3zm7.91 6a1 1 0 0 0-.86 1.5A7.77 7.77 0 0 1 20 14a7.77 7.77 0 0 1-1 3.5 1 1 0 0 0 .87 1.5 1 1 0 0 0 .86-.49A9.8 9.8 0 0 0 22 14a9.8 9.8 0 0 0-1.23-4.51A1 1 0 0 0 19.91 8zM4 14a7.77 7.77 0 0 1 1-3.5 1 1 0 0 0-.87-1.5 1 1 0 0 0-.86.49A9.8 9.8 0 0 0 2 14a9.8 9.8 0 0 0 1.23 4.51 1 1 0 0 0 .86.49 1 1 0 0 0 .87-1.5A7.77 7.77 0 0 1 4 14zm8 8a1 1 0 0 0 1-1v-2.1a5 5 0 0 0 4-4.9h-2a3 3 0 0 1-6 0H7a5 5 0 0 0 4 4.9V21a1 1 0 0 0 1 1z"/>
                </svg>
            </button>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
    // Chatbot Rapace - Version avancée avec synthèse vocale
    class RapaceChatbot {
        constructor() {
            this.name = "Rapace AI";
            this.synth = window.speechSynthesis;
            this.voices = [];
            this.selectedVoice = null;
            this.speechRate = 1;
            this.speechPitch = 1;
            this.ttsEnabled = true;
            this.sttEnabled = true;
            
            // Initialiser les réponses
            this.initResponses();
            
            // Charger les voix disponibles
            this.loadVoices();
            
            
            // Recharger les voix si elles changent
            this.synth.onvoiceschanged = () => this.loadVoices();
        }
        
        initResponses() {
            this.responses = {
                greetings: [
                    `Bonjour ! Je suis ${this.name}, votre assistant intelligent. Comment puis-je vous aider aujourd'hui ?`,
                    `Salut ! Je m'appelle ${this.name}. Posez-moi vos questions et je ferai de mon mieux pour y répondre.`,
                    `Enchanté ! Je suis ${this.name}, prêt à discuter et à vous aider.`
                ],
                questions: {
                    qui: [
                        "Je suis une intelligence artificielle conçue pour vous aider.",
                        "Je suis Rapace AI, votre assistant virtuel.",
                        "Je suis un chatbot programmé pour répondre à vos questions."
                    ],
                    quoi: [
                        "Je peux vous fournir des informations, répondre à des questions et discuter avec vous.",
                        "Je suis capable de traiter différentes requêtes et d'offrir des réponses pertinentes.",
                        "Mon rôle est de vous assister dans diverses tâches et questions."
                    ],
                    où: [
                        "Je suis disponible en ligne, accessible depuis n'importe où.",
                        "Je réside dans le cloud, prêt à vous servir à tout moment.",
                        "Je n'ai pas de localisation physique, je suis partout où vous avez besoin de moi."
                    ],
                    quand: [
                        "Je suis disponible 24 heures sur 24, 7 jours sur 7.",
                        "Vous pouvez me contacter à tout moment, je suis toujours opérationnel.",
                        "Quand vous voulez, je suis là pour vous aider."
                    ],
                    pourquoi: [
                        "Pour vous offrir une assistance immédiate et efficace.",
                        "Pour faciliter votre accès à l'information et à l'aide dont vous avez besoin.",
                        "Parce que tout le monde mérite d'avoir un assistant personnel à sa disposition."
                    ],
                    comment: [
                        "Je fonctionne grâce à des algorithmes d'intelligence artificielle et de traitement du langage.",
                        "Je m'appuie sur des technologies avancées pour comprendre et répondre à vos demandes.",
                        "Mon fonctionnement repose sur le machine learning et l'analyse sémantique."
                    ],
                    default: [
                        "Je comprends votre question. Voici ce que je peux dire...",
                        "Intéressant ! Selon mes informations...",
                        "Bonne question. Examinons cela ensemble..."
                    ]
                },
                statements: [
                    "C'est une remarque très intéressante, merci de ce partage.",
                    "Je note cette information pour nos futures interactions.",
                    "Merci pour cette précision, c'est utile à savoir.",
                    "J'apprécie ce commentaire, cela m'aide à mieux vous comprendre."
                ],
                fallbacks: [
                    "Pourriez-vous reformuler votre demande ? Je n'ai pas bien compris.",
                    "Je ne suis pas sûr de comprendre. Pourriez-vous préciser votre question ?",
                    "Intéressant ! Pourriez-vous développer un peu plus ?",
                    "Je voudrais m'assurer de bien comprendre. Pourriez-vous dire cela autrement ?"
                ]
            };
        }
        
        loadVoices() {
            this.voices = this.synth.getVoices();
            const voiceSelect = document.getElementById('voice-select');
            
            // Vider et reconstruire la liste des voix
            voiceSelect.innerHTML = '';
            
            // Filtrer et ajouter les voix françaises en premier
            const frenchVoices = this.voices.filter(voice => voice.lang.includes('fr'));
            const otherVoices = this.voices.filter(voice => !voice.lang.includes('fr'));
            
            if (frenchVoices.length > 0) {
                const optgroupFr = document.createElement('optgroup');
                optgroupFr.label = 'Voix françaises';
                frenchVoices.forEach(voice => {
                    const option = document.createElement('option');
                    option.textContent = `${voice.name} (${voice.lang})`;
                    option.value = voice.name;
                    optgroupFr.appendChild(option);
                });
                voiceSelect.appendChild(optgroupFr);
            }
            
            if (otherVoices.length > 0) {
                const optgroupOther = document.createElement('optgroup');
                optgroupOther.label = 'Autres voix';
                otherVoices.forEach(voice => {
                    const option = document.createElement('option');
                    option.textContent = `${voice.name} (${voice.lang})`;
                    option.value = voice.name;
                    optgroupOther.appendChild(option);
                });
                voiceSelect.appendChild(optgroupOther);
            }
            
            // Sélectionner une voix française par défaut si disponible
            if (frenchVoices.length > 0) {
                this.selectedVoice = frenchVoices[0];
                voiceSelect.value = frenchVoices[0].name;
            } else if (this.voices.length > 0) {
                this.selectedVoice = this.voices[0];
                voiceSelect.value = this.voices[0].name;
            }
        }
        
        speak(text) {
            if (!this.ttsEnabled || !text) return;
            
            if (this.synth.speaking) {
                this.synth.cancel();
            }
            
            const utterance = new SpeechSynthesisUtterance(text);
            
            if (this.selectedVoice) {
                utterance.voice = this.selectedVoice;
            }
            
            utterance.rate = this.speechRate;
            utterance.pitch = this.speechPitch;
            
            utterance.onerror = (event) => {
                console.error('Erreur de synthèse vocale:', event.error);
                this.showNotification("Erreur de synthèse vocale", "error");
            };
            
            this.synth.speak(utterance);
        }
        
        getResponse(input) {
            const lowerInput = input.toLowerCase();
            
            // Détection du type de message
            if (/(bonjour|salut|coucou|hey|hello)/i.test(lowerInput)) {
                return {
                    text: this.getRandomResponse('greetings'),
                    type: 'greeting'
                };
            }
            else if (/(qui es-tu|qui êtes-vous|who are you)/i.test(lowerInput)) {
                return {
                    text: this.getRandomResponse('questions.qui'),
                    type: 'question'
                };
            }
            else if (/(que fais-tu|que faites-vous|à quoi serves-tu|what do you do|what do you do|what are you for)/i.test(lowerInput)) {
                return {
                    text: this.getRandomResponse('questions.quoi'),
                    type: 'question'
                };
            }
            else if (/(où es-tu|où êtes-vous|where are you)/i.test(lowerInput)) {
                return {
                    text: this.getRandomResponse('questions.où'),
                    type: 'question'
                };
            }
            else if (/(quand|depuis quand|when)/i.test(lowerInput)) {
                return {
                    text: this.getRandomResponse('questions.quand'),
                    type: 'question'
                };
            }
            else if (/(pourquoi|why)/i.test(lowerInput)) {
                return {
                    text: this.getRandomResponse('questions.pourquoi'),
                    type: 'question'
                };
            }
            else if (/(comment|how)/i.test(lowerInput)) {
                return {
                    text: this.getRandomResponse('questions.comment'),
                    type: 'question'
                };
            }
            else if (/(qui|quoi|où|quand|pourquoi|comment|\?)/i.test(lowerInput)) {
                return {
                    text: this.getRandomResponse('questions.default'),
                    type: 'question'
                };
            }
            else if (input.length > 3) {
                return {
                    text: this.getRandomResponse('statements'),
                    type: 'statement'
                };
            }
            else {
                return {
                    text: this.getRandomResponse('fallbacks'),
                    type: 'fallback'
                };
            }
        }
        
        getRandomResponse(path) {
            // Gérer les chemins imbriqués comme 'questions.qui'
            const parts = path.split('.');
            let options = this.responses;
            
            for (const part of parts) {
                options = options[part];
                if (!options) break;
            }
            
            if (Array.isArray(options)) {
                return options[Math.floor(Math.random() * options.length)];
            }
            
            return "Je n'ai pas de réponse appropriée pour cette requête.";
        }
        
        setVoice(voiceName) {
            this.selectedVoice = this.voices.find(v => v.name === voiceName) || null;
        }
        
        setRate(rate) {
            this.speechRate = parseFloat(rate);
        }
        
        setPitch(pitch) {
            this.speechPitch = parseFloat(pitch);
        }
        
        setTTSEnabled(enabled) {
            this.ttsEnabled = enabled;
        }
        
        setSTTEnabled(enabled) {
            this.sttEnabled = enabled;
        }
        
        showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification show ${type}`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    }

    // Initialisation du chat
    document.addEventListener('DOMContentLoaded', () => {
        const chatbot = new RapaceChatbot();
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const voiceButton = document.getElementById('voice-button');
        const thinkingIndicator = document.getElementById('thinking-indicator');
        const settingsBtn = document.getElementById('settings-btn');
        const settingsPanel = document.getElementById('settings-panel');
        const voiceSelect = document.getElementById('voice-select');
        const rateSlider = document.getElementById('rate-slider');
        const rateValue = document.getElementById('rate-value');
        const pitchSlider = document.getElementById('pitch-slider');
        const pitchValue = document.getElementById('pitch-value');
        const ttsToggle = document.getElementById('tts-toggle');
        const sttToggle = document.getElementById('stt-toggle');
        
        // Reconnaissance vocale
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        
        if (SpeechRecognition && chatbot.sttEnabled) {
            recognition = new SpeechRecognition();
            recognition.lang = 'fr-FR';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;
            
            recognition.onstart = () => {
                voiceButton.classList.add('listening');
                chatbot.showNotification("Écoute en cours...", "info");
            };
            
            recognition.onend = () => {
                voiceButton.classList.remove('listening');
            };
            
            recognition.onresult = (event) => {
                const speechResult = event.results[0][0].transcript;
                userInput.value = speechResult;
                handleSend();
            };
            
            recognition.onerror = (event) => {
                console.error('Erreur de reconnaissance vocale:', event.error);
                voiceButton.classList.remove('listening');
                chatbot.showNotification("Erreur de reconnaissance vocale", "error");
            };
        } else if (!SpeechRecognition) {
            voiceButton.style.display = 'none';
            chatbot.showNotification("Reconnaissance vocale non supportée", "warning");
        }
        
        // Gestion des paramètres
        settingsBtn.addEventListener('click', () => {
            settingsPanel.classList.toggle('open');
        });
        
        voiceSelect.addEventListener('change', (e) => {
            chatbot.setVoice(e.target.value);
        });
        
        rateSlider.addEventListener('input', (e) => {
            const value = parseFloat(e.target.value);
            rateValue.textContent = value.toFixed(1);
            chatbot.setRate(value);
        });
        
        pitchSlider.addEventListener('input', (e) => {
            const value = parseFloat(e.target.value);
            pitchValue.textContent = value.toFixed(1);
            chatbot.setPitch(value);
        });
        
        ttsToggle.addEventListener('change', (e) => {
            chatbot.setTTSEnabled(e.target.checked);
        });
        
        sttToggle.addEventListener('change', (e) => {
            chatbot.setSTTEnabled(e.target.checked);
            if (e.target.checked && !recognition && SpeechRecognition) {
                initSpeechRecognition();
            } else if (!e.target.checked && recognition) {
                voiceButton.style.display = 'none';
            } else if (e.target.checked && recognition) {
                voiceButton.style.display = 'flex';
            }
        });
        
        function initSpeechRecognition() {
            recognition = new SpeechRecognition();
            recognition.lang = 'fr-FR';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;
            
            recognition.onstart = () => {
                voiceButton.classList.add('listening');
                chatbot.showNotification("Écoute en cours...", "info");
            };
            
            recognition.onend = () => {
                voiceButton.classList.remove('listening');
            };
            
            recognition.onresult = (event) => {
                const speechResult = event.results[0][0].transcript;
                userInput.value = speechResult;
                handleSend();
            };
            
            recognition.onerror = (event) => {
                console.error('Erreur de reconnaissance vocale:', event.error);
                voiceButton.classList.remove('listening');
                chatbot.showNotification("Erreur de reconnaissance vocale", "error");
            };
            
            voiceButton.style.display = 'flex';
        }
        
        // Ajouter un message dans le chat
        function addMessage(sender, text) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', `${sender}-message`);
            
            const messageContent = document.createElement('div');
            messageContent.textContent = text;
            messageDiv.appendChild(messageContent);
            
            const timeSpan = document.createElement('span');
            timeSpan.classList.add('message-time');
            timeSpan.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            messageDiv.appendChild(timeSpan);
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Faire parler le chatbot si c'est un message du bot
            if (sender === 'bot') {
                chatbot.speak(text);
            }
        }
        
        // Gérer l'envoi de message
        function handleSend() {
            const message = userInput.value.trim();
            if (message) {
                // Afficher le message de l'utilisateur
                addMessage('user', message);
                userInput.value = '';
                
                // Afficher l'indicateur de réflexion
                thinkingIndicator.style.display = 'block';
                
                // Simuler un temps de réflexion
                setTimeout(() => {
                    thinkingIndicator.style.display = 'none';
                    const response = chatbot.getResponse(message);
                    addMessage('bot', response.text);
                }, 1000 + Math.random() * 1000); // Temps variable pour plus de naturel
            }
        }
        
        // Événements
        sendButton.addEventListener('click', handleSend);
        
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleSend();
        });
        
        if (recognition) {
            voiceButton.addEventListener('click', () => {
                if (voiceButton.classList.contains('listening')) {
                    recognition.stop();
                } else {
                    try {
                        recognition.start();
                    } catch (err) {
                        console.error("Erreur de démarrage de la reconnaissance:", err);
                        chatbot.showNotification("Erreur de microphone", "error");
                    }
                }
            });
        }
        
        // Message de bienvenue initial
        setTimeout(() => {
            const welcomeMessage = chatbot.getRandomResponse('greetings');
            addMessage('bot', welcomeMessage);
        }, 1500);
        
        // Focus automatique sur le champ de saisie
        userInput.focus();
    });
    </script>
</body>
</html>